
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">
    <br>
    <br>
    <br>
    <title>COBur Supply Chain</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap theme -->
    <link href="css/bootstrap-theme.min.css" rel="stylesheet">
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->

    <!-- Custom styles for this template -->


    <style>
      #map {
        height: 100%;
        width: 100%;
      }
    </style>    

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">

          <a class="navbar-brand" href="#">COBur</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="#about">About</a></li>
            <li><a href="#contact">Contact</a></li>

          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
    <div id="map">map</div>
    <div class="container theme-showcase" role="main">

      <!-- Main jumbotron for a primary marketing message or call to action -->
      <div class="jumbotron">
        
        <button type="button" class="btn btn-lg btn-success" onclick="showPath()">Next Step</button>

      </div>


    </div> <!-- /container -->

    
    <div>Haaaaaaaaaa</div>
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->

    <script>
var paths = [];
var paths_latlnt = [];
var lines = [];
var map;
var customer_data;
function initMap() {
  var directionsService = new google.maps.DirectionsService;
  var directionsDisplay = new google.maps.DirectionsRenderer;
  map = new google.maps.Map(document.getElementById('map'), {
    zoom: 10,
    center: {lat: 33.85, lng: -118.35}
  });
  directionsDisplay.setMap(map);
  //initialize the route
  //initRoute(directionsService,map);
  
  //drawo terminals
  var customer_data;

  var markers = [];
  var marker_contents = [];
  var infowindows = [];
  var infowindow = new google.maps.InfoWindow();
  var start=[];
  var end=[];
  $.get("customer_data.txt", function(data, status){
      customer_data = JSON.parse(data);


      for (var i = 0; i < customer_data.length; i++) {
          var content = '<h3>cluster_id: ' + customer_data[i].cluster_id + '</h3>' + 
          '<h3>full_in: ' + customer_data[i].full_in + '</h3>' + 
          '<h3>full_out: ' + customer_data[i].full_out + '</h3>' + 
          '<h3>empty_in: ' + customer_data[i].empty_in + '</h3>' + 
          '<h3>empty_out: ' + customer_data[i].empty_out + '</h3>'  

          var pos = {lat: customer_data[i].latitude, lng: customer_data[i].longitude};

          var marker = new google.maps.Marker({
            position: pos,
            map: map,
            title: customer_data[i].customer_id.toString()
          });


          var infowindow = new google.maps.InfoWindow()

          google.maps.event.addListener(marker,'click', (function(marker,content,infowindow){ 
              return function() {
                 infowindow.setContent(content);
                 infowindow.open(map,marker);
              };
          })(marker,content,infowindow)); 

          start.push(pos);
          end.push(pos);
        }
        end = end.slice(1,end.length);
        end.push(start[0])
        getPath(directionsService,start,end);

  });






}


function showPath(){
  // Define the symbol, using one of the predefined paths ('CIRCLE')
  // supplied by the Google Maps JavaScript API.

  animateCircle(lines[0]);

  //animateCircle(initPath);
}




function getPath(directionsService,start,end){


    for (var i = 0; i < start.length; i++) {

        directionsService.route({
        origin: start[i],
        destination: end[i],
        travelMode: google.maps.TravelMode.DRIVING
        }, function(response, status) {
        if (status === google.maps.DirectionsStatus.OK) {
          paths = response.routes;
          tmp = [];
          //draw lines

          for (var i = 0; i <= paths[0].overview_path.length - 1; i++) {
            tmp[i] = paths[0].overview_path[i].toJSON();
            paths_latlnt.push(tmp[i]);
          }

  var truck = {
    scale: 2.5,
 path:'M0,9.466h2.945c-0.196,0.262-0.314,0.582-0.314,0.936H1.18L0,10.103V9.466z M15,7.798v2.604h-1.25 c0-0.037-0.005-0.072-0.008-0.109c-0.014-0.213-0.072-0.416-0.165-0.6c-0.259-0.506-0.783-0.852-1.39-0.852 c-0.863,0-1.563,0.699-1.563,1.561H5.755c0-0.354-0.118-0.674-0.315-0.936h4.656V4.048h2.611v0.625l0.833,2.5L15,7.798z M12.915,7.173l-0.623-1.875h-1.459v1.875H12.915z M5.338,10.402c0,0.633-0.513,1.146-1.144,1.146 c-0.634,0-1.146-0.516-1.146-1.146s0.513-1.145,1.146-1.145C4.825,9.257,5.338,9.771,5.338,10.402z M4.818,10.402 c0-0.344-0.281-0.625-0.624-0.625c-0.347,0-0.628,0.281-0.628,0.625c0,0.348,0.281,0.625,0.628,0.625 C4.537,11.027,4.818,10.749,4.818,10.402z M13.333,10.402c0,0.633-0.515,1.146-1.146,1.146c-0.636,0-1.146-0.516-1.146-1.146 s0.514-1.145,1.146-1.145C12.818,9.257,13.333,9.771,13.333,10.402z M12.812,10.402c0-0.344-0.28-0.625-0.625-0.625 c-0.348,0-0.625,0.281-0.625,0.625c0,0.348,0.277,0.625,0.625,0.625C12.532,11.027,12.812,10.749,12.812,10.402z M9.559,3.232H0 v5.875h9.559V3.232z',
    strokeColor: 'black',
    fillColor: 'gray',
    fillOpacity: 1,
    rotation: -90,
    anchor : google.maps.Point(0,0)
  };

  var fill_con = {
    scale: 0.5,
 path:'M16 48 L48 48 L48 16 L16 16 Z',
    strokeColor: 'red',
    fillColor: 'red',
    fillOpacity: 1,
    anchor : google.maps.Point(0,0)

  };

  var empty_con = {
    scale: 0.5,
 path:'M16 48 L48 48 L48 16 L16 16 Zz',
    strokeColor: 'green',
    fillColor: 'green',
    fillOpacity: 1,
    anchor : google.maps.Point(-10,0)

  };
  var circle1 = {
    scale: 5,
    path:google.maps.SymbolPath.CIRCLE,
    strokeColor: 'green',
    fillColor: 'green',
    fillOpacity: 1,
    anchor : google.maps.Point(0,0)

  };
  var circle2 = {
    scale: 5,
    path:google.maps.SymbolPath.CIRCLE,
    strokeColor: 'yellow',
    fillColor: 'yellow',
    fillOpacity: 1,
    anchor : google.maps.Point(-8,0)

  };


  var initPath = new google.maps.Polyline({
    path: tmp,
    geodesic: true,
    strokeColor: '#FF0000',
    strokeOpacity: 0.7,
    strokeWeight: 3 ,
    map: map,
    icons: [
    {
      icon: truck,
      offset: '4%'
    },
    {
      icon: fill_con,
      offset: '4%'
    },
    {
      icon: empty_con,
      offset: '0%'
    }
    ]
  });
  lines.push(initPath);
  //animateCircle(initPath);

        } else {
          window.alert('Directions request failed due to ' + status);
        }
      });
    }
    return paths;
}

// Use the DOM setInterval() function to change the offset of the symbol
// at fixed intervals.
function animateCircle(line) {
    var count = 0;
    var base = [4,4,0]
    var myInterval = setInterval(function() {
      count = count + 1;

      var icons = line.get('icons');
      for (var i = 0; i < icons.length; i++) {
        icons[i].offset = (( count% 400) / 2+base[i]) + '%';
      }
      
      line.set('icons', icons);
      if (count===400) {
        for (var i = 0; i < icons.length; i++) {
          icons[i].offset = base[i] + '%';
        }
        clearInterval(myInterval);
      }
      
  }, 20);
}

    </script>



    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAILyHqUoQI2e9UDsfgpxJp3N-WQXtjiQ0&callback&signed_in=true&callback=initMap"
        async defer></script>
  </body>
</html>
